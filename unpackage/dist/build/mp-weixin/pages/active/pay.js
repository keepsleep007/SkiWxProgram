(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/active/pay"],{"159e":function(e,t,n){"use strict";(function(e){var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n("7eb4")),o=r(n("34cf")),i=r(n("ee10")),c=n("b816"),u={data:function(){return{payType:1,orderId:"",orderType:"",orderInfo:{},payment:{},serverTime:0,countdown:"10:00",payBtn:!0}},computed:{},onLoad:function(e){var t=this;return(0,i.default)(a.default.mark((function n(){return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:console.log(e),t.orderId=e.orderId,t.orderType=e.type,"1"==e.type&&t.getTicketOrderinfo(),"0"==e.type&&t.getActiveOrderinfo(),"2"==e.type&&t.getTeackerOrderinfo();case 6:case"end":return n.stop()}}),n)})))()},onShow:function(){this.getServerTime()},methods:{getTicketOrderinfo:function(){var e=this,t={};t.id=this.orderId,t.createBy=(0,c.getToken)(),this.request("/app_api/ticket/getOrderinfo",t,"GET").then((function(t){console.log("getTicketOrderinfo:",t),t&&200==t.code&&(e.updateCountdown(t.data.createTime),e.interval=setInterval((function(){e.updateCountdown(t.data.createTime)}),1e3),e.orderInfo=t.data)}))},getActiveOrderinfo:function(){var e=this,t={};t.id=this.orderId,t.createBy=(0,c.getToken)(),this.request("/app_api/activity/getOrderInfo",t,"GET").then((function(t){console.log("getActiveOrderinfo:",t),t&&200==t.code&&(e.updateCountdown(t.data.createTime),e.interval=setInterval((function(){e.updateCountdown(t.data.createTime)}),1e3),e.orderInfo=t.data)}))},getTeackerOrderinfo:function(){var e=this,t={};t.id=this.orderId,t.createBy=(0,c.getToken)(),this.request("/app_api/teacher/getOrderinfo",t,"GET").then((function(t){console.log("getTeackerOrderinfo:",t),t&&200==t.code&&(e.updateCountdown(t.data.createTime),e.interval=setInterval((function(){e.updateCountdown(t.data.createTime)}),1e3),e.orderInfo=t.data)}))},changePayType:function(e){this.payType=e},confirm:function(){var e=(0,i.default)(a.default.mark((function e(){var t,n,r,o=this;return a.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:"0"==this.orderType&&(t={},t.id=this.orderId,t.createBy=(0,c.getToken)(),this.request("/app_api/activity/createPayment",t,"POST").then((function(e){console.log("createPayment:",e),e&&200==e.code&&(o.payment=e.data,o.requestPayment(o.payment))}))),"1"==this.orderType&&(n={},n.id=this.orderId,n.createBy=(0,c.getToken)(),this.request("/app_api/ticket/createPayment",n,"POST").then((function(e){console.log("createPayment:",e),e&&200==e.code&&(o.payment=e.data,o.requestPayment(o.payment))}))),"2"==this.orderType&&(r={},r.id=this.orderId,r.createBy=(0,c.getToken)(),this.request("/app_api/teacher/createPayment",r,"POST").then((function(e){console.log("createPayment:",e),e&&200==e.code&&(o.payment=e.data,o.requestPayment(o.payment))})));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),requestPayment:function(t){e.requestPayment({provider:"wxpay",timeStamp:t.timeStamp,nonceStr:t.nonceStr,package:t.packageVal,signType:t.signType,paySign:t.paySign,success:function(t){console.log("success:"+JSON.stringify(t)),e.redirectTo({url:"/pages/active/paySuccess"})},fail:function(e){console.log("fail:"+JSON.stringify(e))}})},getServerTime:function(){var e=this;return(0,i.default)(a.default.mark((function t(){return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.request("/app_api/util/getServerTime","","GET").then((function(t){t&&(console.log("getServerTime",t),200==t.code&&(e.serverTime=t.data))}));case 2:case"end":return t.stop()}}),t)})))()},calculateCountdown:function(e){var t=new Date(e).getTime()/1e3,n=t+600,r=this.serverTime+(Date.now()/1e3-this.serverTime),a=n-r;if(a<=0)return this.payBtn=!1,"00:00";var o=Math.floor(a/60),i=Math.floor(a%60);return"".concat(String(o).padStart(2,"0"),":").concat(String(i).padStart(2,"0"))},updateCountdown:function(e){var t=this.formatDate(e);this.countdown=this.calculateCountdown(t)},formatDate:function(e){var t=e.split(" "),n=(0,o.default)(t,2),r=n[0],a=n[1],i=r.split("-"),c=(0,o.default)(i,3),u=c[0],d=c[1],s=c[2],f=a.split(":"),p=(0,o.default)(f,3),l=p[0],g=p[1],h=p[2],m=new Date(u,d-1,s,l,g,h),v=String(m.getFullYear()),y=String(m.getMonth()+1).padStart(2,"0"),T=String(m.getDate()).padStart(2,"0"),S=String(m.getHours()).padStart(2,"0"),w=String(m.getMinutes()).padStart(2,"0"),k=String(m.getSeconds()).padStart(2,"0");return"".concat(v,"/").concat(y,"/").concat(T," ").concat(S,":").concat(w,":").concat(k)}},beforeDestroy:function(){clearInterval(this.interval)}};t.default=u}).call(this,n("df3c")["default"])},"1fd4":function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return r}));var r={uIcon:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-icon/u-icon")]).then(n.bind(null,"48b6"))}},a=function(){var e=this.$createElement;this._self._c},o=[]},"5b07":function(e,t,n){},"82cf":function(e,t,n){"use strict";n.r(t);var r=n("159e"),a=n.n(r);for(var o in r)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(o);t["default"]=a.a},b9d0:function(e,t,n){"use strict";var r=n("5b07"),a=n.n(r);a.a},cd4b:function(e,t,n){"use strict";(function(e,t){var r=n("47a9");n("d090");r(n("3240"));var a=r(n("e8de"));e.__webpack_require_UNI_MP_PLUGIN__=n,t(a.default)}).call(this,n("3223")["default"],n("df3c")["createPage"])},e8de:function(e,t,n){"use strict";n.r(t);var r=n("1fd4"),a=n("82cf");for(var o in a)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(o);n("b9d0");var i=n("828b"),c=Object(i["a"])(a["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],void 0);t["default"]=c.exports}},[["cd4b","common/runtime","common/vendor"]]]);