(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/teacher/teacherAdd"],{"600c":function(e,t,a){"use strict";var n=a("a2d2"),r=a.n(n);r.a},"98aa":function(e,t,a){"use strict";(function(e,t){var n=a("47a9");a("d090");n(a("3240"));var r=n(a("cba2"));e.__webpack_require_UNI_MP_PLUGIN__=a,t(r.default)}).call(this,a("3223")["default"],a("df3c")["createPage"])},a2d2:function(e,t,a){},c67e:function(e,t,a){"use strict";a.d(t,"b",(function(){return r})),a.d(t,"c",(function(){return o})),a.d(t,"a",(function(){return n}));var n={uniForms:function(){return Promise.all([a.e("common/vendor"),a.e("uni_modules/uni-forms/components/uni-forms/uni-forms")]).then(a.bind(null,"8d8a"))},uniCard:function(){return a.e("uni_modules/uni-card/components/uni-card/uni-card").then(a.bind(null,"dd67"))},uniFormsItem:function(){return Promise.all([a.e("common/vendor"),a.e("uni_modules/uni-forms/components/uni-forms-item/uni-forms-item")]).then(a.bind(null,"34a0"))},uniEasyinput:function(){return a.e("uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput").then(a.bind(null,"80e2"))},uniDataSelect:function(){return Promise.all([a.e("common/vendor"),a.e("uni_modules/uni-data-select/components/uni-data-select/uni-data-select")]).then(a.bind(null,"fa28"))},uniFilePicker:function(){return Promise.all([a.e("common/vendor"),a.e("uni_modules/uni-file-picker/components/uni-file-picker/uni-file-picker")]).then(a.bind(null,"7950"))},uniNumberBox:function(){return a.e("uni_modules/uni-number-box/components/uni-number-box/uni-number-box").then(a.bind(null,"9503"))},uniPopup:function(){return a.e("uni_modules/uni-popup/components/uni-popup/uni-popup").then(a.bind(null,"8570"))},uniPopupDialog:function(){return Promise.all([a.e("common/vendor"),a.e("uni_modules/uni-popup/components/uni-popup-dialog/uni-popup-dialog")]).then(a.bind(null,"3b6c"))},uniDataCheckbox:function(){return Promise.all([a.e("common/vendor"),a.e("uni_modules/uni-data-checkbox/components/uni-data-checkbox/uni-data-checkbox")]).then(a.bind(null,"9d4c"))}},r=function(){var e=this.$createElement;this._self._c},o=[]},c8bf:function(e,t,a){"use strict";(function(e){var n=a("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a("7eb4")),o=n(a("ee10")),i=a("b816");function s(e,t){var a="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=function(e,t){if(!e)return;if("string"===typeof e)return u(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return u(e,t)}(e))||t&&e&&"number"===typeof e.length){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==a.return||a.return()}finally{if(s)throw o}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var l={data:function(){return{statusShow:!1,statusFlag:!1,editFlag:"",subBtnTitle:"",switchText:"他人可在教练列表看到你",snowAreaCheckBox:"",iSex:[{value:"0",text:"男"},{value:"1",text:"女"}],teachType:[],teacherSystem:[],teacherLevel:[],teachMode:[],snowField:[],snowField_tree:[],skiVideoShowFlag:!1,teacherVideoShowFlag:!1,snowFieldArr:[],isDisabled:!1,formData:{status:"",nickname:"",iSex:"",phone:"",headPhoto:"",introduce:"",tags:"",skiAge:0,teachAge:0,teachType:"",skiResort:"",skiResortName:"",teacherSystem:"",teacherLevel:"",teacher_priceList:[{tcMode:"",tcTime:1,price:""}],skiVideo:"",teacherVideo:"",caFilePath:"",headPhotoShow:[],skiVideoShow:[],teacherVideoShow:[],caFilePathShow:[],reviewText:"",reviewTime:""},rules:{nickname:{rules:[{required:!0,errorMessage:"不能为空"}]},iSex:{rules:[{required:!0,errorMessage:"不能为空"}]},phone:{rules:[{required:!0,errorMessage:"不能为空"},{pattern:"^1[3-9]\\d{9}$",errorMessage:"手机号格式不正确"}]},headPhotoShow:{rules:[{required:!0,errorMessage:"不能为空"}]},introduce:{rules:[{required:!0,errorMessage:"不能为空"}]},tags:{rules:[{required:!0,errorMessage:"不能为空"}]},skiAge:{rules:[{required:!0,errorMessage:"不能为空"}]},teachAge:{rules:[{required:!0,errorMessage:"不能为空"}]},teachType:{rules:[{required:!0,errorMessage:"不能为空"}]},skiResortName:{rules:[{required:!0,errorMessage:"不能为空"}]},teacherSystem:{rules:[{required:!0,errorMessage:"不能为空"}]},teacherLevel:{rules:[{required:!0,errorMessage:"不能为空"}]},caFilePathShow:{rules:[{required:!0,errorMessage:"不能为空"}]}}}},onLoad:function(t){var a=this;return(0,o.default)(r.default.mark((function t(){return r.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.showLoading({title:"加载中"}),t.next=3,a.getBaseData();case 3:return t.next=5,a.getSnowField();case 5:return t.next=7,a.getData();case 7:e.hideLoading();case 8:case"end":return t.stop()}}),t)})))()},onReady:function(){this.$refs.teacherInfoForm.setRules(this.rules)},methods:{submit:function(t){var a=this;this.$refs[t].validate().then((function(t){a.isDisabled=!0,setTimeout((function(){a.isDisabled=!1}),2e3),a.formData.skiResort=a.snowFieldArr.join(","),a.formData.appToken=(0,i.getToken)(),"add"==a.editFlag?a.request("/app_api/teacher/addTeacherInfo",a.formData,"POST").then((function(t){t&&(200==t.code&&e.redirectTo({url:"/pages/teacher/teacherAddsuccess?flag=1"}),500==t.code&&e.showToast({title:t.msg,icon:"none",duration:2e3}))})):"edit"==a.editFlag?a.request("/app_api/teacher/updateTeacherInfo",a.formData,"POST").then((function(t){console.log("updateTeacherInfo:",a.formData),t&&200==t.code&&e.redirectTo({url:"/pages/teacher/teacherAddsuccess?flag=2"})})):"revAdd"==a.editFlag&&(a.formData.reviewStatus="0",a.request("/app_api/teacher/updateTeacherInfo",a.formData,"POST").then((function(t){console.log("updateTeacherInfo:",a.formData),t&&200==t.code&&e.redirectTo({url:"/pages/teacher/teacherAddsuccess?flag=2"})})))})).catch((function(t){console.log("err",t),e.showToast({title:"存在未填项，请检查",icon:"none",duration:2e3})}))},getData:function(){var e=this;return(0,o.default)(r.default.mark((function t(){var a;return r.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={},a.createBy=(0,i.getToken)(),t.next=4,e.request("/app_api/teacher/getTeacherInfo_MyInfo",a,"GET").then((function(t){if(t&&200==t.code){if(0==t.data.length)return e.editFlag="add",void(e.subBtnTitle="提交");"0"===t.data[0].reviewStatus?(e.editFlag="",e.subBtnTitle="审核中",e.isDisabled=!0):"1"===t.data[0].reviewStatus?(e.editFlag="edit",e.subBtnTitle="更新"):"2"===t.data[0].reviewStatus&&(e.editFlag="revAdd",e.subBtnTitle="重新提交"),"1"===t.data[0].reviewStatus&&(e.statusShow=!0),"0"==t.data[0].status&&(e.statusFlag=!0),"1"==t.data[0].status&&(e.statusFlag=!1),t.data[0].headPhotoShow={name:"1.png",extname:"png",url:e.getBaseUrl()+t.data[0].headPhoto},t.data[0].skiVideoShow={name:"滑行视频",extname:"mp4",url:e.getBaseUrl()+t.data[0].skiVideo},e.skiVideoShowFlag=!0,t.data[0].teacherVideoShow={name:"教学视频",extname:"mp4",url:e.getBaseUrl()+t.data[0].teacherVideo},e.teacherVideoShowFlag=!0,t.data[0].caFilePathShow={name:"1.png",extname:"png",url:e.getBaseUrl()+t.data[0].caFilePath},e.formData=t.data[0],e.snowFieldArr=t.data[0].skiResort.split(","),e.snowFieldCodeToName();for(var a=0;a<e.snowFieldArr.length;a++)for(var n=0;n<e.snowField.length;n++)if(e.snowField[n].tid==e.snowFieldArr[a])for(var r=0;r<e.snowField_tree.length;r++)e.snowField_tree[r].id==e.snowField[n].pid&&e.snowField_tree[r].checkbox.push(Number(e.snowFieldArr[a]))}}));case 4:case"end":return t.stop()}}),t)})))()},getBaseData:function(){var e=this;return(0,o.default)(r.default.mark((function t(){return r.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.request("/app_api/teacher/loadTeacherSystemTag","GET").then((function(t){if(t){for(var a=0;a<t.data.length;a++)for(var n=0;n<t.data[a].length;n++)t.data[a][n].value=t.data[a][n].dictValue,t.data[a][n].text=t.data[a][n].dictLabel;e.teacherSystem=t.data[0],e.teachType=t.data[1],e.teachMode=t.data[2],e.teacherLevel=t.data[3]}}));case 2:case"end":return t.stop()}}),t)})))()},getSnowField:function(){var e=this;return(0,o.default)(r.default.mark((function t(){return r.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.request("/app_api/snowField/listFieldAll","GET").then((function(t){if(t){e.snowField_tree=e.handleTree(t.data,"id","pid");for(var a=0;a<e.snowField_tree.length;a++)void 0==e.snowField_tree[a].children&&(e.snowField_tree[a].children=[]),e.snowField_tree[a].checkbox=[];e.snowField=t.data}}));case 2:case"end":return t.stop()}}),t)})))()},imageUpload:function(t,a){var n=this;console.log("开始上传",t);var r=t.tempFiles[0].size;if(r>10485760)return console.log("fileSize",r),console.log("maxSize",10485760),void e.showToast({title:"上传失败，文件大小不能超过10MB，请重新选择",icon:"none"});e.uploadFile({url:(0,i.getConfig)().uploadUrl,name:"file",filePath:t.tempFiles[0].path,header:{"Content-Type":"multipart/form-data"},success:function(t){e.hideLoading();var r=JSON.parse(t.data),o=n.getBaseUrl()+r.fileName;if(200==r.code){if(1==a){n.formData.headPhoto=r.fileName;var i={name:"1.png",extname:"png",url:o};n.formData.headPhotoShow=i}if(2==a){n.formData.caFilePath=r.fileName;var s={name:"1.png",extname:"png",url:o};n.formData.caFilePathShow=s}e.showToast({title:"上传成功",icon:"success",duration:2e3})}},fail:function(t){console.log("err",t),e.showToast({title:"上传失败，请重试",icon:"success",duration:2e3})}})},videoUpload:function(t,a,n){var r=this;console.log("开始上传",t);var o=t.tempFiles[0].size;if(o>52428800)return console.log("fileSize",o),console.log("maxSize",52428800),void e.showToast({title:"上传失败，文件大小不能超过50MB，请重新选择",icon:"none"});var s=e.uploadFile({url:(0,i.getConfig)().uploadUrl,name:"file",filePath:t.tempFiles[0].path,header:{"Content-Type":"multipart/form-data"},success:function(t){e.hideLoading();var n=JSON.parse(t.data),o=r.getBaseUrl()+n.fileName;if(200==n.code){if(3==a){r.formData.skiVideo=n.fileName,r.skiVideoShowFlag=!0;var i={name:"滑行视频",extname:"mp4",url:o};r.formData.skiVideoShow=i}if(4==a){r.formData.teacherVideo=n.fileName,r.teacherVideoShowFlag=!0;var s={name:"教学视频",extname:"mp4",url:o};r.formData.teacherVideoShow=s}e.showToast({title:"上传成功",icon:"success",duration:2e3})}},fail:function(t){console.log("err",t),e.showToast({title:"上传失败，请重试",icon:"success",duration:2e3})}});s.onProgressUpdate((function(e){r.$refs[n].files[0].progress=e.progress}))},delVideo:function(e,t){3==t&&(this.formData.skiVideo="",this.skiVideoShowFlag=!1),4==t&&(this.formData.teacherVideo="",this.teacherVideoShowFlag=!1)},openSkiResport:function(){this.$refs.popup.open()},snowFieldClick:function(){this.snowFieldArr=[];for(var e=0;e<this.snowField_tree.length;e++)if(this.snowField_tree[e].checkbox)for(var t=0;t<this.snowField_tree[e].checkbox.length;t++)this.snowFieldArr.push(this.snowField_tree[e].checkbox[t]);this.$refs.popup.close(),this.snowFieldCodeToName()},snowFieldCodeToName:function(){for(var e=[],t=0;t<this.snowFieldArr.length;t++)for(var a=0;a<this.snowField.length;a++)this.snowFieldArr[t]==this.snowField[a].tid&&e.push(this.snowField[a].label);this.formData.skiResortName=e.join(",")},addRow:function(){this.formData.teacher_priceList.push({tcMode:"",tcTime:1,price:""})},delRow:function(){this.formData.teacher_priceList.length>1&&this.formData.teacher_priceList.splice(this.formData.teacher_priceList.length-1,1)},switchChange:function(t){console.log("switch1 发生 change 事件，携带值为",t.detail.value);var a={};1==t.detail.value&&(this.switchText="他人可在教练列表看到你",a.status="0",this.formData.status="0"),0==t.detail.value&&(this.switchText="他人不可在教练列表看到你",a.status="1",this.formData.status="1"),a.createBy=(0,i.getToken)(),this.request("/app_api/teacher/updateStatus",a,"POST").then((function(t){console.log(t),t&&(200==t.code&&e.showToast({title:"操作成功，接单状态已变更",icon:"none",duration:3e3}),500==t.code&&e.showToast({title:t.msg,icon:"none",duration:3e3}))}))},handleTree:function(e,t,a,n){var r,o={id:t||"id",parentId:a||"parentId",childrenList:n||"children"},i={},u={},l=[],c=s(e);try{for(c.s();!(r=c.n()).done;){var d=r.value,h=d[o.parentId];null==i[h]&&(i[h]=[]),u[d[o.id]]=d,i[h].push(d)}}catch(T){c.e(T)}finally{c.f()}var f,p=s(e);try{for(p.s();!(f=p.n()).done;){var m=f.value,g=m[o.parentId];null==u[g]&&l.push(m)}}catch(T){p.e(T)}finally{p.f()}for(var w=0,v=l;w<v.length;w++){var F=v[w];b(F)}function b(e){if(null!==i[e[o.id]]&&(e[o.childrenList]=i[e[o.id]]),e[o.childrenList]){var t,a=s(e[o.childrenList]);try{for(a.s();!(t=a.n()).done;){var n=t.value;b(n)}}catch(T){a.e(T)}finally{a.f()}}}return l},dialogToggle:function(){this.msgType="info",this.$refs.alertDialog.open()},dialogConfirm:function(){console.log("点击确认")},dialogClose:function(){console.log("点击拒绝，返回上一页"),e.navigateBack({delta:1})}}};t.default=l}).call(this,a("df3c")["default"])},cba2:function(e,t,a){"use strict";a.r(t);var n=a("c67e"),r=a("ee11");for(var o in r)["default"].indexOf(o)<0&&function(e){a.d(t,e,(function(){return r[e]}))}(o);a("600c");var i=a("828b"),s=Object(i["a"])(r["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],void 0);t["default"]=s.exports},ee11:function(e,t,a){"use strict";a.r(t);var n=a("c8bf"),r=a.n(n);for(var o in n)["default"].indexOf(o)<0&&function(e){a.d(t,e,(function(){return n[e]}))}(o);t["default"]=r.a}},[["98aa","common/runtime","common/vendor"]]]);