(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/me/myRelease/r-ticket-page-add"],{"161d":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n("b816");function i(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return r(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var a=0,i=function(){};return{s:i,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,u=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return u=e.done,e},e:function(e){l=!0,o=e},f:function(){try{u||null==n.return||n.return()}finally{if(l)throw o}}}}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var o={data:function(){return{id:null,formData:{type:"",price:"",ticketNum:"",snowFieldArea:"",snowFieldId:"",applyTime:"",snowType:"",location:"",remark:"",phone:"",wechat:"",uid:""},select_data_type:[{value:"1",text:"转卖"},{value:"2",text:"求购"}],select_data_snowType:[],snowField:[],rules:{type:{rules:[{required:!0,errorMessage:"类型不能为空"}]},price:{rules:[{required:!0,errorMessage:"价格不能为空"}]},ticketNum:{rules:[{required:!0,errorMessage:"数量不能为空"}]},snowFieldId:{rules:[{required:!0,errorMessage:"雪场不能为空"}]},applyTime:{rules:[{required:!0,errorMessage:"时间不能为空"}]},snowType:{rules:[{required:!0,errorMessage:"时段不能为空"}]},location:{rules:[{required:!0,errorMessage:"地点不能为空"}]}}}},computed:{},onLoad:function(e){null!=e.id&&(this.id=e.id,this.getData()),this.getAreaData(),this.getTicketTypeData()},onReady:function(){},methods:{submit:function(t){var n=this;this.$refs[t].validate().then((function(t){n.validatePhoneWeChat()&&(console.log("success",t),n.formData.appToken=(0,a.getToken)(),null==n.id?n.request("/app_api/ticketMarket/addTicketInfo",n.formData,"POST").then((function(t){t&&200==t.code&&e.reLaunch({url:"/pages/me/myRelease/r-submitSuccess?tabIndex=2"})})):n.request("/app_api/ticketMarket/updateTicketInfo",n.formData,"POST").then((function(t){t&&200==t.code&&e.navigateTo({url:"/pages/me/myRelease/r-submitSuccess?tabIndex=2"})})))})).catch((function(e){console.log("err",e)}))},validatePhoneWeChat:function(){var t=!0,n="";return this.formData.phone||this.formData.wechat?this.formData.phone&&!/^1[3-9]\d{9}$/.test(this.formData.phone)?(t=!1,n="电话格式不正确"):this.formData.wechat&&!/^[\w\-_]{3,20}$/.test(this.formData.wechat)&&(t=!1,n="微信格式不正确"):(t=!1,n="电话或微信必须填写一个"),t?(console.log("表单校验通过，可以提交"),!0):(e.showToast({title:n,icon:"none"}),!1)},getData:function(){var e=this;console.log("请求后台，获取数据"),this.formData.id=this.id,this.request("/app_api/ticketMarket/getTicketInfo",this.formData,"GET").then((function(t){t&&200==t.code&&(e.formData.avatar=t.data.avatar,e.formData.type=t.data.type,e.formData.price=t.data.price,e.formData.ticketNum=t.data.ticketNum,e.formData.snowFieldArea=t.data.snowFieldArea,e.formData.snowFieldId=t.data.snowFieldId,e.formData.applyTime=t.data.applyTime,e.formData.snowType=t.data.snowType,e.formData.location=t.data.location,e.formData.remark=t.data.remark,e.formData.phone=t.data.phone,e.formData.wechat=t.data.wechat,e.formData.uid=t.data.uid)}))},getAreaData:function(){var e=this;this.request("/app_api/ticketMarket/loadAreaData","","GET").then((function(t){if(t){for(var n=[],a=0;a<t.data.length;a++)n[a]={},n[a]["text"]=t.data[a].label,n[a]["value"]=t.data[a].id,n[a]["id"]=t.data[a].id,n[a]["pid"]=t.data[a].pid;e.snowField=e.handleTree(n,"id","pid")}}))},getTicketTypeData:function(){var e=this;this.request("/app_api/ticketMarket/loadTicketType","","GET").then((function(t){if(t){for(var n=[],a=0;a<t.data.length;a++)n[a]={},n[a]["text"]=t.data[a].dictLabel,n[a]["value"]=t.data[a].dictValue;e.select_data_snowType=n}}))},onchange:function(e){console.log("onchange:",e),this.formData.snowFieldArea=e.detail.value[0].value,this.formData.snowFieldId=e.detail.value[1].value},handleTree:function(e,t,n,a){var r,o={id:t||"id",parentId:n||"parentId",childrenList:a||"children"},u={},l={},c=[],d=i(e);try{for(d.s();!(r=d.n()).done;){var s=r.value,f=s[o.parentId];null==u[f]&&(u[f]=[]),l[s[o.id]]=s,u[f].push(s)}}catch(k){d.e(k)}finally{d.f()}var m,p=i(e);try{for(p.s();!(m=p.n()).done;){var h=m.value,v=h[o.parentId];null==l[v]&&c.push(h)}}catch(k){p.e(k)}finally{p.f()}for(var g=0,y=c;g<y.length;g++){var b=y[g];D(b)}function D(e){if(null!==u[e[o.id]]&&(e[o.childrenList]=u[e[o.id]]),e[o.childrenList]){var t,n=i(e[o.childrenList]);try{for(n.s();!(t=n.n()).done;){var a=t.value;D(a)}}catch(k){n.e(k)}finally{n.f()}}}return c},dialogToggle:function(){this.msgType="info",this.$refs.alertDialog.open()},dialogConfirm:function(){console.log("点击确认")},dialogClose:function(){console.log("点击拒绝，返回上一页"),e.navigateBack({delta:1})}}};t.default=o}).call(this,n("df3c")["default"])},2323:function(e,t,n){"use strict";n.r(t);var a=n("161d"),i=n.n(a);for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);t["default"]=i.a},4847:function(e,t,n){"use strict";(function(e,t){var a=n("47a9");n("d090");a(n("3240"));var i=a(n("f886"));e.__webpack_require_UNI_MP_PLUGIN__=n,t(i.default)}).call(this,n("3223")["default"],n("df3c")["createPage"])},"8c9e":function(e,t,n){},d983:function(e,t,n){"use strict";var a=n("8c9e"),i=n.n(a);i.a},dc59:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return a}));var a={uniForms:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-forms/components/uni-forms/uni-forms")]).then(n.bind(null,"8d8a"))},uniCard:function(){return n.e("uni_modules/uni-card/components/uni-card/uni-card").then(n.bind(null,"dd67"))},uniFormsItem:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-forms/components/uni-forms-item/uni-forms-item")]).then(n.bind(null,"34a0"))},uniDataSelect:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-data-select/components/uni-data-select/uni-data-select")]).then(n.bind(null,"fa28"))},uniEasyinput:function(){return n.e("uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput").then(n.bind(null,"80e2"))},uniNumberBox:function(){return n.e("uni_modules/uni-number-box/components/uni-number-box/uni-number-box").then(n.bind(null,"9503"))},uniDataPicker:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-data-picker/components/uni-data-picker/uni-data-picker")]).then(n.bind(null,"cedb"))},uniDatetimePicker:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-datetime-picker/components/uni-datetime-picker/uni-datetime-picker")]).then(n.bind(null,"a467"))},uniPopup:function(){return n.e("uni_modules/uni-popup/components/uni-popup/uni-popup").then(n.bind(null,"8570"))},uniPopupDialog:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-popup/components/uni-popup-dialog/uni-popup-dialog")]).then(n.bind(null,"3b6c"))}},i=function(){var e=this.$createElement;this._self._c},r=[]},f886:function(e,t,n){"use strict";n.r(t);var a=n("dc59"),i=n("2323");for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);n("d983");var o=n("828b"),u=Object(o["a"])(i["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],void 0);t["default"]=u.exports}},[["4847","common/runtime","common/vendor"]]]);