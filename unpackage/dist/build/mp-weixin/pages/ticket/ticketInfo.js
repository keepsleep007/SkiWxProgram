(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/ticket/ticketInfo"],{"090d":function(t,e,a){"use strict";(function(t,e){var r=a("47a9");a("d090");r(a("3240"));var n=r(a("882c"));t.__webpack_require_UNI_MP_PLUGIN__=a,e(n.default)}).call(this,a("3223")["default"],a("df3c")["createPage"])},"2baa":function(t,e,a){},"3ad2":function(t,e,a){"use strict";var r=a("2baa"),n=a.n(r);n.a},"882c":function(t,e,a){"use strict";a.r(e);var r=a("e94c"),n=a("cdd5");for(var i in n)["default"].indexOf(i)<0&&function(t){a.d(e,t,(function(){return n[t]}))}(i);a("3ad2");var c=a("828b"),o=Object(c["a"])(n["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],void 0);e["default"]=o.exports},9092:function(t,e,a){"use strict";(function(t){var r=a("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=r(a("7eb4")),i=r(a("ee10")),c=a("b816");function o(t,e){var a="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=function(t,e){if(!t)return;if("string"===typeof t)return u(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return u(t,e)}(t))||e&&t&&"number"===typeof t.length){a&&(t=a);var r=0,n=function(){};return{s:n,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,c=!0,o=!1;return{s:function(){a=a.call(t)},n:function(){var t=a.next();return c=t.done,t},e:function(t){o=!0,i=t},f:function(){try{c||null==a.return||a.return()}finally{if(o)throw i}}}}function u(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,r=new Array(e);a<e;a++)r[a]=t[a];return r}var s={components:{},data:function(){return{sonwId:"",productId:"",stockId:"",currDate:"",productData:"",dates:[],price:0,startDate:this.getDate().fullDate,dateClass:"none",infoRichTextFlag:!1,priceRichTextFlag:!1,shortRichTextFlag:!1,disclaimerRichTextFlag:!1}},onLoad:function(t){var e=this;return(0,i.default)(n.default.mark((function a(){return n.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return console.log("options",t),e.sonwId=t.sonwId,e.productId=t.productId,e.stockId=t.stockId,null==t.stockDate?e.currDate=e.getDate().fullDate:e.currDate=t.stockDate,a.next=7,e.getNextFourDatesWithWeekdays(e.currDate);case 7:e.dates=a.sent,e.getProductInfo();case 9:case"end":return a.stop()}}),a)})))()},onShareAppMessage:function(t){return"button"===t.from&&console.log(t.target),{title:"分享了商品信息，一起看看吧~",path:"/pages/ticket/ticketInfo?productId="+this.productId}},methods:{getProductInfo:function(){var t=this,e={};e.id=this.productId,this.request("/app_api/ticket/getProductInfo",e,"GET").then((function(e){console.log("getProductInfo",e),e&&200==e.code&&(null!=e.data.tag&&(e.data.tag=e.data.tag.split("/")),e.data.shortRichText&&(e.data.shortRichText=t.fixImageSrcInHtml(e.data.shortRichText,t.getBaseUrl()),"<p><br></p>"===e.data.shortRichText?t.shortRichTextFlag=!1:t.shortRichTextFlag=!0),e.data.infoRichText&&(e.data.infoRichText=t.fixImageSrcInHtml(e.data.infoRichText,t.getBaseUrl()),"<p><br></p>"===e.data.infoRichText?t.infoRichTextFlag=!1:t.infoRichTextFlag=!0),e.data.priceRichText&&(e.data.priceRichText=t.fixImageSrcInHtml(e.data.priceRichText,t.getBaseUrl()),"<p><br></p>"===e.data.priceRichText?t.priceRichTextFlag=!1:t.priceRichTextFlag=!0),t.productData=e.data,t.getDisclaimerRichText(e.data.skiDisclaimerId))}))},getDisclaimerRichText:function(t){var e=this,a={};a.skiDisclaimerId=t,this.request("/app_api/activity/getDisclaimer",a,"GET").then((function(t){console.log("getDisclaimer",t),t&&200==t.code&&t.data&&(t.data.disclaimerRichText&&(t.data.disclaimerRichText=e.fixImageSrcInHtml(t.data.disclaimerRichText,e.getBaseUrl()),e.disclaimerRichTextFlag=!0),e.productData.disclaimerRichText=t.data.disclaimerRichText)}))},subProduct:function(){var e,a=o(this.dates);try{for(a.s();!(e=a.n()).done;){var r=e.value;if(r.date===this.currDate&&0===r.stockNumber)return void t.showToast({title:"指定日期库存不足",icon:"none",duration:2e3})}}catch(n){a.e(n)}finally{a.f()}(0,c.needLogin)()&&void 0==(0,c.getUserInfo)()?t.navigateTo({url:"/pages/me/login-page"}):t.navigateTo({url:"/pages/ticket/ticketOrder?productId="+this.productId+"&stockId="+this.stockId+"&stockDate="+this.currDate+"&price="+this.price+"&title="+this.productData.title+"&sonwId="+this.sonwId})},toggleSpecDateProduct:function(){var t=this;"show"===this.dateClass?(this.dateClass="hide",setTimeout((function(){t.dateClass="none"}),250)):"none"===this.dateClass&&(this.dateClass="show")},dateChange:function(t){var e=this;return(0,i.default)(n.default.mark((function a(){return n.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,e.getNextFourDatesWithWeekdays(t.fulldate);case 2:e.dates=a.sent,e.currDate=t.fulldate;case 4:case"end":return a.stop()}}),a)})))()},monthSwitch:function(t){console.log("monthSwitchs 返回:",t)},fixImageSrcInHtml:function(t,e){if(t){var a,r=/src="([^"]+)"/g,n=[];while(null!==(a=r.exec(t))){var i=a[1];i.startsWith("/profile")?n.push(e+i):n.push(i)}var c=t;return n.forEach((function(e,a){var n=r.exec(t)[1];c=c.replace(n,e)})),c}console.error("HTML文本不能为空")},getDate:function(){var t=new Date,e=t.getFullYear(),a=t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1,r=t.getDate()<10?"0"+t.getDate():t.getDate();return{fullDate:e+"-"+a+"-"+r,year:e,month:a,date:r,day:t.getDay()}},getNextFourDatesWithWeekdays:function(t){var e=this;return(0,i.default)(n.default.mark((function a(){var r,i,c,o,u,s,d,l,f;return n.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:for(r=[],i=new Date(t),c=[],o=["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],u=0;u<4;u++)s=new Date(i),s.setDate(s.getDate()+u),d=s.getDay(),l=o[d],c.push({date:s.toISOString().split("T")[0],weekday:l,stockNumber:0,priceOld:0,price:0}),r.push(s.toISOString().split("T")[0]);return f={},f.id=e.productId,f.dates=r.join(","),a.next=10,e.request("/app_api/ticket/getTicketStockNumber",f,"GET").then((function(t){if(t&&200==t.code){var e=t.data;c.forEach((function(t){var a=e.find((function(e){return e.stockDate===t.date}));a&&(t.stockNumber=a.stockNumber,t.priceOld=a.priceOld,t.price=a.price)}))}}));case 10:return e.price=c[0].price,a.abrupt("return",c);case 12:case"end":return a.stop()}}),a)})))()},changeDateCard:function(t){this.price=t.price,this.currDate=t.date},formatDateToMMDD:function(t){return t.slice(5,10)}}};e.default=s}).call(this,a("df3c")["default"])},cdd5:function(t,e,a){"use strict";a.r(e);var r=a("9092"),n=a.n(r);for(var i in r)["default"].indexOf(i)<0&&function(t){a.d(e,t,(function(){return r[t]}))}(i);e["default"]=n.a},e94c:function(t,e,a){"use strict";a.d(e,"b",(function(){return n})),a.d(e,"c",(function(){return i})),a.d(e,"a",(function(){return r}));var r={uniTag:function(){return a.e("uni_modules/uni-tag/components/uni-tag/uni-tag").then(a.bind(null,"9861"))},uniCalendar:function(){return Promise.all([a.e("common/vendor"),a.e("uni_modules/uni-calendar/components/uni-calendar/uni-calendar")]).then(a.bind(null,"9597"))}},n=function(){var t=this,e=t.$createElement,a=(t._self._c,t.getBaseUrl()),r=t.__map(t.dates,(function(e,a){var r=t.__get_orig(e),n=t.formatDateToMMDD(e.date);return{$orig:r,m1:n}}));t.$mp.data=Object.assign({},{$root:{m0:a,l0:r}})},i=[]}},[["090d","common/runtime","common/vendor"]]]);