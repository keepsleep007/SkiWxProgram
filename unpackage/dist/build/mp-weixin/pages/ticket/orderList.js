(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/ticket/orderList"],{"06b7":function(e,t,n){"use strict";n.r(t);var o=n("309b"),r=n("9d71");for(var a in r)["default"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(a);n("80b7");var i=n("828b"),u=Object(i["a"])(r["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],void 0);t["default"]=u.exports},"309b":function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return o}));var o={uniLoadMore:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-load-more/components/uni-load-more/uni-load-more")]).then(n.bind(null,"94e9"))},uniPopup:function(){return n.e("uni_modules/uni-popup/components/uni-popup/uni-popup").then(n.bind(null,"8570"))},uniPopupDialog:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-popup/components/uni-popup-dialog/uni-popup-dialog")]).then(n.bind(null,"3b6c"))}},r=function(){var e=this,t=e.$createElement,n=(e._self._c,e.__map(e.navList,(function(t,n){var o=e.__get_orig(t),r=!0===t.loaded&&0===t.orderList.length;return{$orig:o,g0:r}})));e.$mp.data=Object.assign({},{$root:{l0:n}})},a=[]},"6a39":function(e,t,n){"use strict";(function(e,t){var o=n("47a9");n("d090");o(n("3240"));var r=o(n("06b7"));e.__webpack_require_UNI_MP_PLUGIN__=n,t(r.default)}).call(this,n("3223")["default"],n("df3c")["createPage"])},"80b7":function(e,t,n){"use strict";var o=n("e1ca"),r=n.n(o);r.a},"9d71":function(e,t,n){"use strict";n.r(t);var o=n("9ef1"),r=n.n(o);for(var a in o)["default"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(a);t["default"]=r.a},"9ef1":function(e,t,n){"use strict";(function(e){var o=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(n("7eb4")),a=o(n("ee10")),i=n("b816"),u={components:{empty:function(){n.e("pages/active/empty").then(function(){return resolve(n("b7e9"))}.bind(null,n)).catch(n.oe)}},data:function(){return{pageNum:1,pageSize:10,tabCurrentIndex:0,teachModeList:[],navList:[{state:0,text:"全部",loadingType:"more",orderList:[]},{state:1,text:"待付款",loadingType:"more",orderList:[]},{state:2,text:"待服务",loadingType:"more",orderList:[]},{state:3,text:"已完成",loadingType:"more",orderList:[]},{state:4,text:"已关闭",loadingType:"more",orderList:[]}],closeItem:{},serverTime:0}},onLoad:function(e){var t=this;return(0,a.default)(r.default.mark((function n(){return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:console.log("orderList-options",e),t.tabCurrentIndex=e.state,0==e.state&&t.loadData();case 3:case"end":return n.stop()}}),n)})))()},methods:{loadData:function(e){var t=this;return(0,a.default)(r.default.mark((function n(){var o,a,i,u;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.getServerTime();case 2:if(o=t.tabCurrentIndex,a=t.navList[o],a.state,"tabChange"===e&&(t.pageNum=1,a.loadingType="more",a.orderList=[]),"noMore"!==a.loadingType){n.next=9;break}return console.log("没有更多数据了"),n.abrupt("return");case 9:return a.loadingType="loading",n.next=12,t.loadDataForBackground(t.tabCurrentIndex,t.pageNum,t.pageSize);case 12:i=n.sent,console.log("orderArr",i),u=i[0],u.forEach((function(e){a.orderList.push(e)})),t.$set(a,"loaded",!0),a.orderList.length>=i[1]?a.loadingType="noMore":(a.loadingType="more",t.pageNum=t.pageNum+1);case 18:case"end":return n.stop()}}),n)})))()},loadDataForBackground:function(t,n,o){var u=this;return(0,a.default)(r.default.mark((function a(){var s,c,d;return r.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return s={},s.pageNum=n,s.pageSize=o,s.createBy=(0,i.getToken)(),0==t&&console.log("全部"),1==t&&(console.log("待付款"),s.orderStatus=3),2==t&&(console.log("待服务"),s.orderStatus=2),3==t&&(console.log("已完成"),s.orderStatus=1),4==t&&(console.log("已关闭"),s.orderStatus=0),c=[],d=[],r.next=13,u.request("/app_api/ticket/getTikcetOrderList",s,"GET").then((function(t){if(t){if(console.log("getTikcetOrderList",t),200==t.code){for(var n=t.data[0],o=0;o<n.length;o++){if(c[o]={},c[o]["state"]=n[o].orderStatus,0==n[o].orderStatus&&(c[o]["stateTip"]="已关闭",c[o]["stateTipColor"]="#909399"),1==n[o].orderStatus&&(c[o]["stateTip"]="已完成",c[o]["stateTipColor"]="#fa436a"),2==n[o].orderStatus&&(c[o]["stateTip"]="待服务",c[o]["stateTipColor"]="#fa436a"),3==n[o].orderStatus){c[o]["stateTip"]="待付款",c[o]["stateTipColor"]="#fa436a";var r=new Date(n[o].createTime).getTime()/1e3,a=r+600;console.log("serverTime",u.serverTime),console.log("endTime",a),u.serverTime>a&&(console.log("订单超时未支付"),n[o].orderStatus=0,c[o]["stateTip"]="已关闭",c[o]["stateTipColor"]="#909399")}c[o]["time"]=n[o].createTime,c[o]["orderNo"]=n[o].orderNo,c[o]["orderStatus"]=n[o].orderStatus,c[o]["payStatus"]=n[o].payStatus,c[o]["id"]=n[o].id,c[o]["title"]=n[o].title,c[o]["payMoney"]=n[o].payMoney,c[o]["wantPayMoney"]=n[o].wantPayMoney,c[o]["saleNumber"]=n[o].saleNumber,c[o]["useDate"]=n[o].useDate}d[1]=t.data[1]}500==t.code&&e.showToast({title:t.msg,icon:"none",duration:2e3})}})).catch((function(t){e.showToast({title:t,icon:"none",duration:2e3})}));case 13:return d[0]=c,r.abrupt("return",d);case 15:case"end":return r.stop()}}),a)})))()},changeTab:function(e){this.tabCurrentIndex=e.target.current,this.loadData("tabChange")},tabClick:function(e){this.tabCurrentIndex=e},deleteOrder:function(t){var n=this;e.showLoading({title:"请稍后"}),setTimeout((function(){n.navList[n.tabCurrentIndex].orderList.splice(t,1),e.hideLoading()}),600)},cancelOrder:function(e){this.closeItem=e,this.msgType="info",this.$refs.alertDialog.open()},dialogClose:function(){console.log("点击关闭")},dialogConfirm:function(){var t=this.closeItem;console.log("点击确认");var n={};n.id=t.id,this.request("/app_api/ticket/cancelTicketOrder",n,"POST").then((function(n){n&&200==n.code&&1==n.data&&(t.orderStatus="0",t.stateTip="已关闭",t.stateTipColor="#909399",e.showToast({title:"取消成功",icon:"none",duration:2e3}))}))},orderStateExp:function(e){var t="",n="#fa436a";switch(+e){case 1:t="待付款";break;case 2:t="待发货";break;case 9:t="订单已关闭",n="#909399";break}return{stateTip:t,stateTipColor:n}},toOrderInfo:function(t){console.log("toOrderInfo",t),e.navigateTo({url:"/pages/ticket/orderListInfo?id="+t.id})},toPay:function(t){e.navigateTo({url:"/pages/active/pay?orderId="+t+"&type=1"})},getServerTime:function(){var e=this;return(0,a.default)(r.default.mark((function t(){return r.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.request("/app_api/util/getServerTime","","GET").then((function(t){t&&(console.log("getServerTime",t),200==t.code&&(e.serverTime=t.data))}));case 2:case"end":return t.stop()}}),t)})))()}}};t.default=u}).call(this,n("df3c")["default"])},e1ca:function(e,t,n){}},[["6a39","common/runtime","common/vendor"]]]);